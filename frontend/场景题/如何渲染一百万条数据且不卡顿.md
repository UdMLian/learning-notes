```html
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>10ä¸‡æ•°æ®æ¸²æŸ“æ€§èƒ½æµ‹è¯•</title>
    <style>
        /* 1. å¡é¡¿æ£€æµ‹å™¨ï¼šä¸€ä¸ªä¸€ç›´åœ¨è½¬çš„å°æ–¹å— */
        #spinner {
            width: 50px;
            height: 50px;
            background-color: #409EFF;
            margin: 20px;
            /* æ”¹ç”¨ width å˜åŒ–åŠ¨ç”» */
            animation: expand 1s linear infinite alternate;
        }

        @keyframes expand {
            0% {
                width: 50px;
            }

            100% {
                width: 200px;
            }
        }

        /* ç®€å•çš„å¸ƒå±€ */
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        .controls {
            margin-bottom: 20px;
        }

        button {
            padding: 10px 20px;
            cursor: pointer;
            margin-right: 10px;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            padding: 5px;
            border-bottom: 1px solid #eee;
            font-size: 12px;
        }
    </style>
</head>

<body>

    <div id="spinner"></div>
    <h3>å½“å‰çŠ¶æ€: <span id="status">ç©ºé—²</span></h3>

    <div class="controls">
        <button onclick="directRender()">ğŸš« ç›´æ¥æ¸²æŸ“ (ä¼šå¡æ­»)</button>
        <button onclick="startIdleRender()">âœ… requestIdleCallback (ä½ çš„ä»»åŠ¡)</button>
        <button class="btn-good" onclick="startTimerRender()">âœ… setTimeout åˆ†æ‰¹ (ä½ çš„ä»»åŠ¡)</button>
        <button class="btn-good" onclick="startChannelRender()">âš¡ MessageChannel (Fast)</button>
        <button class="btn-run" onclick="startRafRender()">ğŸ¬ Start requestAnimationFrame</button>

    </div>

    <ul id="list"></ul>

    <script>
        const total = 100000; // æ¸²æŸ“ 10 ä¸‡æ¡
        const ul = document.getElementById('list');
        const status = document.getElementById('status');

        // ç”Ÿæˆä¸€ä¸ªç®€å•çš„åˆ—è¡¨é¡¹ DOM
        function createItem(i) {
            const li = document.createElement('li');
            li.innerText = `ç¬¬ ${i} æ¡æ•°æ® - è¿™é‡Œçš„æ¸²æŸ“ä¼šå ç”¨ CPU`;
            return li;
        }

        // ==========================================
        // âŒ å¯¹ç…§ç»„ï¼šä¸€æ¬¡æ€§ç›´æ¥æ¸²æŸ“
        // ==========================================
        function directRender() {
            ul.innerHTML = ''; // æ¸…ç©º
            status.innerText = "æ­£åœ¨ç–¯ç‹‚è®¡ç®—ä¸­... (çœ‹ä¸Šé¢æ˜¯ä¸æ˜¯åœäº†ï¼Ÿ)";

            // å¼ºåˆ¶è®© UI å…ˆåˆ·æ–°ä¸€ä¸‹æ–‡æ¡ˆï¼Œå¦åˆ™ç›´æ¥å¡æ­»è¿æ–‡æ¡ˆéƒ½å˜ä¸äº†
            setTimeout(() => {
                const start = performance.now();

                // è¿™æ˜¯ä¸€ä¸ªé•¿ä»»åŠ¡ï¼Œéœ¸å ä¸»çº¿ç¨‹
                for (let i = 0; i < total; i++) {
                    ul.appendChild(createItem(i));
                }

                const end = performance.now();
                status.innerText = `å®Œæˆï¼è€—æ—¶: ${(end - start).toFixed(0)}ms`;
                alert("æ¸²æŸ“å®Œæˆï¼Œåˆšæ‰é¡µé¢æ˜¯ä¸æ˜¯å¡æ­»äº†ï¼Ÿ");
            }, 0);
        }

        // ==========================================
        // âœ… å®éªŒç»„ï¼šè¿™é‡Œéœ€è¦ä½ æ¥ç¼–å†™
        // ==========================================

        // å…¨å±€å˜é‡ï¼Œè®°å½•å½“å‰å¤„ç†åˆ°ç¬¬å‡ ä¸ªäº†
        let currentIndex = 0;

        function startIdleRender() {
            ul.innerHTML = ''; // æ¸…ç©º
            currentIndex = 0;  // é‡ç½®ç´¢å¼•
            status.innerText = "å¼€å§‹åˆ†æ‰¹æ¸²æŸ“... (é£è½¦åº”è¯¥è¿˜åœ¨è½¬)";

            // å¼€å§‹è°ƒç”¨ä½ çš„å‡½æ•°
            window.requestIdleCallback(myIdleWork);
        }

        // ğŸŸ¢ ä½ çš„ä»»åŠ¡ï¼šå®ç°è¿™ä¸ªå‡½æ•°
        function myIdleWork(deadline) {
            // å‚æ•° deadline æ˜¯æµè§ˆå™¨ä¼ è¿›æ¥çš„ï¼Œå®ƒæœ‰ä¸¤ä¸ªé‡è¦å±æ€§ï¼š
            // 1. deadline.timeRemaining() -> è¿”å›å½“å‰å¸§è¿˜å‰©å¤šå°‘æ¯«ç§’å¯ç”¨
            // 2. deadline.didTimeout -> æ˜¯å¦è¶…æ—¶

            // TODO: è¯·åœ¨è¿™é‡Œç¼–å†™é€»è¾‘
            while (deadline.timeRemaining() && currentIndex < total) {
                ul.appendChild(createItem(currentIndex))
                currentIndex++
            }
            if (currentIndex < total) {
                window.requestIdleCallback(myIdleWork)
            } else {
                alert('æ¸²æŸ“å®Œæˆ')
            }
        }
        /*
        é¦–å…ˆè¦ä»‹ç»ä¸€ä¸‹ requestIdleCallback è¿™ä¸ªå‡½æ•°
        è¿™ä¸ªå‡½æ•°å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°ï¼Œç¬¬äºŒå“¥å‚æ•°æ˜¯å¯é€‰çš„é…ç½®å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡å…·æœ‰ä¸€ä¸ªå±æ€§timeoutï¼Œå¦‚æœå›è°ƒåœ¨è¶…æ—¶
        å‰æ²¡æœ‰è¢«è°ƒç”¨ï¼Œé‚£ä¹ˆä¼šè¢«åŠ å…¥äº‹ä»¶å¾ªç¯é˜Ÿåˆ—æ’é˜Ÿ
        ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯å›è°ƒå‡½æ•°ä¼šè¢«ä¼ å…¥ä¸€ä¸ªå‚æ•°IdleDeadLineï¼Œå¯ä»¥ç”¨äºè·å–å½“å‰ç©ºé—²äº‹ä»¶ä»¥åŠå›è°ƒæ˜¯å¦åœ¨è¶…æ—¶æ—¶é—´å‰å·²ç»æ‰§è¡Œçš„çŠ¶æ€

        é‚£ä¹ˆæ˜¯å¦‚ä½•é€šè¿‡è¿™ä¸ªå‡½æ•°å®ç°æ•°æ®çš„åˆ†æ®µå¤„ç†é¿å…é€ æˆé¡µé¢æ¸²æŸ“å¡é¡¿çš„å‘¢ï¼Ÿ
        é¦–å…ˆæˆ‘ä»¬è¦çŸ¥é“æµè§ˆå™¨æ¯16msæ›´æ–°ä¸€å¸§ï¼Œè¿™æ ·è‚‰çœ¼è§‚å¯Ÿçš„æ—¶å€™é¡µé¢æ‰ä¸ä¼šå¡é¡¿ï¼Œè€Œè¿™16msä¸ä¼šå…¨éƒ¨éƒ½ç”¨äºæ¸²æŸ“ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è¿™äº›æ²¡ç”¨äºæ¸²æŸ“
        çš„æ—¶é—´æ¥å¤„ç†å›è°ƒä»»åŠ¡

        å½“è¿™ä¸€å¸§æ¸²æŸ“ä¹‹åä»ç„¶æœ‰ç©ºé—²æ—¶é—´å¤„ç†å›è°ƒä»»åŠ¡å¹¶ä¸”å›è°ƒä»»åŠ¡æ²¡æœ‰å¤„ç†å®Œçš„æ—¶å€™ï¼Œå°±ç»§ç»­é€šè¿‡requestIdleCallbackå¤„ç†å›è°ƒå‡½æ•°ï¼Œ
        å¦‚æœæ‰€æœ‰æ•°æ®éƒ½å¤„ç†å®Œæˆäº†ï¼Œå°±ç»“æŸæ‰§è¡Œ
        */



        // === âœ… å®éªŒç»„ï¼šå‡†å¤‡å·¥ä½œ ===
        function startTimerRender() {
            ul.innerHTML = '';
            currentIndex = 0;
            status.innerText = "æ­£åœ¨ä½¿ç”¨ setTimeout åˆ†æ‰¹æ¸²æŸ“...";

            // ğŸš€ å¯åŠ¨ç¬¬ä¸€æ‰¹
            setTimeout(renderBatch, 0);
        }

        // ============================================================
        // ğŸŸ¢ ä½ çš„ä»»åŠ¡ï¼šå®ç°åŸºäº setTimeout çš„åˆ†æ‰¹é€»è¾‘
        // ============================================================
        let basic = 200
        function renderBatch() {

            // ã€æ€è·¯æ­¥éª¤ 1ã€‘ï¼šåˆ›å»ºä¸€ä¸ªå†…å­˜å®¹å™¨ (DocumentFragment)
            // è§£é‡Šï¼šä¾ç„¶è¦ç”¨å®ƒï¼Œå¦åˆ™ä¸€æ‰¹æ’å…¥200æ¬¡DOMä¹Ÿä¼šå°å¡ã€‚
            // ä»£ç ï¼šconst fragment = ...
            const fragment = document.createDocumentFragment()

            // ã€æ€è·¯æ­¥éª¤ 2ã€‘ï¼šè®¡ç®—è¿™ä¸€æ‰¹çš„æˆªæ­¢ä½ç½®
            // è§£é‡Šï¼šæˆ‘ä»¬éœ€è¦è®¡ç®—è¿™æ¬¡å¾ªç¯è¦åœåœ¨å“ªé‡Œã€‚
            //       åº”è¯¥æ˜¯ "å½“å‰ä½ç½® + 200"ï¼Œä½†ä¸èƒ½è¶…è¿‡ "æ€»æ•° total"ã€‚
            // ä»£ç ï¼šconst end = Math.min( ... , ... );
            const end = Math.min(total, currentIndex + basic)

            // ã€æ€è·¯æ­¥éª¤ 3ã€‘ï¼šè·‘ä¸€ä¸ªå°å¾ªç¯
            // è§£é‡Šï¼šä» currentIndex å¾ªç¯åˆ° endã€‚
            //       åœ¨å¾ªç¯é‡Œåˆ›å»ºèŠ‚ç‚¹ï¼Œæ”¾åˆ° fragment é‡Œã€‚
            // ä»£ç ï¼šfor ( ... ) { ... }
            for (let i = currentIndex; i < end; i++) {
                fragment.appendChild(createItem(i))
            }


            // ã€æ€è·¯æ­¥éª¤ 4ã€‘ï¼šä¸Šæ¶æ•°æ® & æ›´æ–°æŒ‡é’ˆ
            // è§£é‡Šï¼šå¾ªç¯ç»“æŸï¼ŒæŠŠ fragment å¡è¿› ulï¼Œå¹¶æ›´æ–° currentIndexã€‚
            // ä»£ç ï¼šul.appendChild(...);
            //       currentIndex = end;
            ul.appendChild(fragment)
            currentIndex = end

            // ã€æ€è·¯æ­¥éª¤ 5ã€‘ï¼šæ ¸å¿ƒâ€”â€”é¢„çº¦ä¸‹ä¸€æ‰¹
            // è§£é‡Šï¼šå¦‚æœ currentIndex è¿˜æ²¡åˆ° totalï¼Œ
            //       å°±ç”¨ setTimeout(renderBatch, 0) 
            //       æŠŠä¸‹ä¸€æ‰¹ä»»åŠ¡æ’é˜Ÿåˆ°æµè§ˆå™¨ç»˜åˆ¶ä»»åŠ¡ä¹‹åã€‚
            // ä»£ç ï¼šif (...) { ... } else { ... }
            if (currentIndex < total) {
                setTimeout(renderBatch, 0)
            } else {
                alert('æ¸²æŸ“å®Œæˆ')
            }

        }

        /*
        è®¡æ—¶å™¨çš„ä½œç”¨å°±æ˜¯å°†ä»»åŠ¡æ‹†åˆ†æˆè®¸å¤šæ¯”è¾ƒå°çš„éƒ¨åˆ†ï¼Œæ¯æ¬¡å›è°ƒä»»åŠ¡éƒ½ä¼šè¢«åŠ å…¥ä»»åŠ¡é˜Ÿåˆ—çš„æœ€æœ«å°¾
        è¿™æ ·ä»»åŠ¡å°±ä¸æ˜¯è¿ç»­æ‰§è¡Œçš„ï¼Œä¸¤æ¬¡ä»»åŠ¡æ‰§è¡Œçš„é—´éš™å…¶ä»–çš„æ¸²æŸ“ä»»åŠ¡ä¹Ÿå¯ä»¥æ‰§è¡Œ
        è¿™é‡Œæ˜¯é€šè¿‡æ¯æ¬¡ä»»åŠ¡åªæ‰§è¡Œæ·»åŠ 200ä¸ªDOMå®ç°çš„
        */




        // ============================================================
        // ğŸŸ¢ ä½ çš„ä»»åŠ¡ï¼šå®ç° MessageChannel é€»è¾‘
        // ============================================================

        // ã€æ­¥éª¤ 1ï¼šå®šä¹‰ç®¡é“ã€‘
        // ä¸ºäº†é¿å…åœ¨é€’å½’ä¸­åå¤åˆ›å»ºï¼Œæˆ‘ä»¬åœ¨å…¨å±€è¿™é‡Œåˆ›å»ºä¸€ä¸ª Channel
        // è¯·åˆå§‹åŒ– MessageChannel
        // ä»£ç ï¼šconst channel = ...
        const channel = new MessageChannel()
        // ä»£ç ï¼šconst port1 = ...
        const port1 = channel.port1
        // ä»£ç ï¼šconst port2 = ...
        const port2 = channel.port2

        // ã€æ­¥éª¤ 2ï¼šç»‘å®šç›‘å¬ã€‘
        // å‘Šè¯‰ port1ï¼Œå½“æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œå»æ‰§è¡Œ renderBatch å‡½æ•°
        // ä»£ç ï¼šport1.onmessage = ...
        port1.onmessage = renderBatch


        function startChannelRender() {
            ul.innerHTML = '';
            currentIndex = 0;
            status.innerText = "Running via MessageChannel...";

            // ğŸš€ å¯åŠ¨å¼•æ“ï¼šæ‰‹åŠ¨è§¦å‘ç¬¬ä¸€æ¬¡
            renderBatch();
        }

        function renderBatch() {
            // æ ‡å‡†çš„ DOM ä¼˜åŒ–é€»è¾‘ (è¿™ä¸€æ­¥è·Ÿä¹‹å‰ä¸€æ ·)
            let batchSize = 200
            const fragment = document.createDocumentFragment();
            const end = Math.min(total, currentIndex + batchSize);

            for (let i = currentIndex; i < end; i++) {
                fragment.appendChild(createItem(i));
            }

            ul.appendChild(fragment);
            currentIndex = end;

            // ã€æ­¥éª¤ 3ï¼šå‘é€ä¿¡å·ã€‘
            // å¦‚æœä»»åŠ¡æ²¡å®Œæˆï¼Œé€šè¿‡ port2 å‘é€ä¸€ä¸ªæ¶ˆæ¯
            // è¿™ä¼šè§¦å‘ port1 çš„ onmessageï¼Œä»è€Œå†æ¬¡è°ƒç”¨ renderBatch
            // ä»£ç ï¼šif (...) { ... } else { ... }
            if (currentIndex < total) {
                port2.postMessage(null)
            } else {
                alert('æ¸²æŸ“å®Œæˆ')
            }
        }

        /* 
        è¿™ä¸ªæ–¹æ³•å…¶å®æœ¬è´¨ä¸Šå’Œè®¡æ—¶å™¨å·®ä¸å¤šéƒ½æ˜¯ä¸€æ¬¡æ€§å¤„ç†200æ¡æ•°æ®æ’å…¥ï¼Œç„¶åä¸¤æ¬¡å›è°ƒä»»åŠ¡ä¹‹å‰æ‰§è¡Œåˆ«çš„æ¸²æŸ“æ“ä½œ
        è¿™ä¸ªport1æ˜¯ç›‘å¬çš„ï¼Œå¦‚æœè§¦å‘ç›‘å¬æ‰§è¡ŒrenderBatchå‡½æ•°ï¼Œport2æ˜¯ç”¨äºè§¦å‘ç›‘å¬çš„ï¼Œä¸€æ¬¡å›è°ƒä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹å
        å‡å¦‚ä¸æ˜¯æ‰€æœ‰æ•°æ®éƒ½æ¸²æŸ“å®Œæˆé‚£ä¹ˆï¼Œä¼šè§¦å‘port1ç›‘å¬çš„å›è°ƒï¼Œç”±æ­¤å°†ä¸‹ä¸€æ¬¡å›è°ƒä»»åŠ¡æ”¾å…¥é˜Ÿå°¾
        è¿™ä¸ªæ–¹æ³•çš„å¥½å¤„åœ¨äºï¼Œå¯¹äºè®¡æ—¶å™¨æ¥è¯´ï¼Œè®¡æ—¶å™¨å°†å›è°ƒåŠ å…¥é˜Ÿåˆ—ä¹‹å‰è¦ç­‰å¾…4msï¼Œè™½çƒ­è¯´æ˜¯0msï¼Œå…¶å®è¦ç­‰4msæ‰åŠ å…¥
        ä½†æ˜¯ä½¿ç”¨MessageChannelçš„è¯æ¯æ¬¡åŠ å…¥é˜Ÿåˆ—éƒ½æ˜¯çœŸæ­£çš„0msä¸€æ—¦è§¦å‘å›è°ƒï¼Œé©¬ä¸ŠæŠŠå›è°ƒåŠ å…¥é˜Ÿåˆ—
        */




        // ============================================================
        // ğŸŸ¢ ä½ çš„ä»»åŠ¡ï¼šrequestAnimationFrame å®ç°
        // ============================================================

        function startRafRender() {
            ul.innerHTML = '';
            currentIndex = 0;
            status.innerText = "Rendering via rAF...";

            // ğŸš€ å¯åŠ¨ç¬¬ä¸€å¸§
            requestAnimationFrame(renderFrame);
        }

        function renderFrame() {
            // ã€æ­¥éª¤ 1ã€‘è®°å½•å½“å‰çš„æ¯«ç§’æ•° (æè¡¨)
            const startTime = performance.now();

            const fragment = document.createDocumentFragment();

            // ã€æ­¥éª¤ 2ã€‘æ—¶é—´æ§åˆ¶å¾ªç¯
            // é€»è¾‘ï¼šåªè¦ä»»åŠ¡æ²¡åšå®Œ (currentIndex < total)
            //       å¹¶ä¸”ï¼æœ¬æ¬¡æ‰§è¡Œæ—¶é—´å°äº 10ms (performance.now() - startTime < 10)
            //       å°±ä¸€ç›´å¹²æ´»
            while (currentIndex < total && (performance.now() - startTime < 1)) {

                fragment.appendChild(createItem(currentIndex));
                currentIndex++;

            }

            // ã€æ­¥éª¤ 3ã€‘ä¸Šæ¶
            ul.appendChild(fragment);

            // ã€æ­¥éª¤ 4ã€‘åˆ¤æ–­ä¸‹ä¸€å¸§
            if (currentIndex < total) {
                // æ—¶é—´ä¸å¤Ÿäº†ï¼Œä¸ºäº†ä¸å¡é£è½¦ï¼ŒæŠŠå‰©ä¸‹çš„æ”¾åˆ°"ä¸‹ä¸€å¸§"å»å¤„ç†
                requestAnimationFrame(renderFrame);
            } else {
                status.innerText = "âœ… rAF Render Done!";
                alert("å®Œæˆï¼");
            }
        }

        /*
        é¦–å…ˆè¦æ˜ç™½ä¸€ç‚¹ï¼ŒrequestAnimationFrameå‡½æ•°çš„ä½œç”¨æ˜¯ï¼Œåœ¨è¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œä¹‹åä¼šç«‹åˆ»è¿›è¡Œä¸€æ¬¡å±å¹•ç»˜åˆ¶
        å·²çŸ¥ç»˜åˆ¶ä¸€æ¬¡å±å¹•çš„é—´éš”æ˜¯16msï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨å±å¹•ç»˜åˆ¶ä¹‹å‰ç”¨xmsçš„æ—¶é—´æ¥å¤„ç†æ•°æ®ï¼Œå†ç”¨ä¸€æ®µæ—¶é—´æ¸²æŸ“å¤„ç†å¥½çš„DOM
        ç„¶åå†é©¬ä¸Šè¿›è¡Œç»˜åˆ¶ï¼Œè¿™æ ·å°±å¯ä»¥è®©æ¯ä¸€å¸§éƒ½æœ‰æ—¶é—´è¿›è¡Œç»˜åˆ¶ï¼Œå¹¶ä¸”é€šè¿‡å›è°ƒå¯¹æ•°æ®è¿›è¡Œåˆ†æ®µå¤„ç†
        */

    </script>
</body>

</html>
```

